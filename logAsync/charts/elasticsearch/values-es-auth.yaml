elasticsearch:
  global:
    storageClass: "managed-nfs-storage"
    elasticsearch:
      service:
        name: elasticsearch
        ports:
          restAPI: 9200
    kibanaEnabled: true
  nameOverride: "elasticsearch"
  fullnameOverride: "elasticsearch"
  clusterName: logs
  containerPorts:
    restAPI: 9200
    transport: 9300
  image:
    registry: docker.io
    repository: bitnami/elasticsearch
    tag: 8.5.3-debian-11-r8
    pullPolicy: IfNotPresent
  security:
    enabled: true
    elasticPassword: "password"
    tls:
      autoGenerated: true
      usePemCerts: false
      keystorePassword: "password"
      truststorePassword: "password"
      keyPassword: "password"
  service:
    type: ClusterIP
    ports:
      restAPI: 9200
      transport: 9300
  ingress:
    enabled: true
    pathType: Prefix
    hostname: elasticsearch.gordey.local
    path: /
    ingressClassName: "system-ingress"
  master:
    masterOnly: true
    replicaCount: 2
    nameOverride: "elasticsearch-master"
    fullnameOverride: "elasticsearch-master"
    resources:
      limits: {}
      requests:
        cpu: 250m
        memory: 256Mi
    heapSize: 128m
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - elasticsearch-master
            - key: role
              operator: In
              values:
                - elasticsearch-master
          topologyKey: kubernetes.io/hostname
    persistence:
      enabled: true
      storageClass: "managed-nfs-storage"
      accessModes:
        - ReadWriteOnce
      size: 8Gi
  data:
    replicaCount: 2
    nameOverride: "elasticsearch-data"
    fullnameOverride: "elasticsearch-data"
    updateStrategy:
      type: RollingUpdate
    resources:
      limits: {}
      requests:
        cpu: 25m
        memory: 1024Mi
    heapSize: 1024m
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - elasticsearch-data
              - key: role
                operator: In
                values:
                  - elasticsearch-data
          topologyKey: kubernetes.io/hostname
    persistence:
      enabled: true
      storageClass: "managed-nfs-storage"
      accessModes:
        - ReadWriteOnce
      size: 8Gi
  coordinating:
    replicaCount: 1
    resources:
      limits: {}
      requests:
        cpu: 25m
        memory: 256Mi
    heapSize: 128m
  ingest:
    replicaCount: 1
    containerPorts:
      restAPI: 9200
      transport: 9300
    resources:
      limits: {}
      requests:
        cpu: 25m
        memory: 256Mi
    heapSize: 128m
  metrics:
    enabled: true
    image:
      registry: docker.io
      repository: bitnami/elasticsearch-exporter
      tag: 1.5.0-debian-11-r55
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 9114
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9114"
    podAnnotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "9114"

  volumePermissions:
    enabled: true
    image:
      registry: docker.io
      repository: bitnami/bitnami-shell
      tag: 11-debian-11-r68
      pullPolicy: IfNotPresent
  sysctlImage:
    enabled: true
    registry: docker.io
    repository: bitnami/bitnami-shell
    tag: 11-debian-11-r68
  kibana:
    image:
      debug: true
    elasticsearch:
      hosts:
        - '{{ include "elasticsearch.service.name" . }}'
      port: '{{ include "elasticsearch.service.ports.restAPI" . }}'
      security:
        auth:
          enabled: true
          createSystemUser: true
          kibanaPassword: "password"
          elasticsearchPasswordSecret: "elasticsearch"
        tls:
          enabled: true
          verificationMode: "full"
          existingSecret: "elasticsearch-master-crt"
          usePemCerts: true
          truststorePassword: "password"
    persistence:
      enabled: true
      storageClass: "managed-nfs-storage"
      accessModes:
        - ReadWriteOnce
      size: 5Gi
    volumePermissions:
      enabled: true
    resources:
      limits:
      requests:
        cpu: 100m
        memory: 256Mi
    ingress:
      enabled: true
      pathType: Prefix
      hostname: kibana.gordey.local
      path: /
