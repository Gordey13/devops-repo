Настроим  файловый сервер Samba 
протокол SMB - протокол работы с файловым серверам от Microsoft

обновим базу доступных для установки пакетов 
sudo apt-get update && upgrade
Установка призводится вот этой командой:
sudo apt-get install samba

Идем в папку с конфигурационными файлами samba
cd /etc/samba
Дефолтную конфигурацию удаляем либо переименовывать
mv перемещает и переименовывает файл
sudo mv smb.conf smb.conf.old

Cоздаем два пустых файла:
sudo touch smb.conf - конфигурация файлового сервера
sudo touch smbusers - содержать логины и пароли (зашифрованные) пользователей файлового сервера.

Cоздадим папку, которую будем расшаривать в сеть.
sudo mkdir /opt/firstShare
sudo chmod 0777 /opt/firstShare

Открываем файл smb.conf в редакторе (nano, mcedit, vim, emacs, ee)
Конфигурация сервера состоит из нескольких секций.
Основная секция [global] и каждая шара будет настроена отдельной секцией, 
также обозначенной квадратными скобками [share1], [share2], [Music], [Video]

1. Настраиваем общие настройки - секцию [global]
2. Дадим нашему серверу имя будет виден в сетевом окружении
server string = Test Fileserver Samba
3. Опишем рабочую группу общий для всех компьютеров по умолчанию WORKGROUP
workgroup = WORKGROUP
4. Зададим роль сервера - обычный файловый сервер
server role = standalone server
5. Настроим параметры авторизации
security = user
- Указываем тип авторизации 
- user - авторизация по логину и паролю
- domain - авторизация по логину, паролю и домену
- share - анонимная шара. без авторизации
6. Указываем тип БД пользователей
passdb backend = smbpasswd
7. Указываем файл БД пользователей
smb passwd file = /etc/samba/smbusers
8. Принудительно разрешаем шифрованние паролей для безопасности
encrypt passwords = yes
9. Запрещаем гостевой вход
map to guest = bad user
10. Логирование
Указываем файл, в который будут писаться сообщения,
также уровень логирования (от 0 до 7)
Чем выше цифра уровня логирования, тем подробнее 
log file = /var/log/samba/log.%m

1. Определить имя шары 
Под этим именем расшаренная папка будет видна из сети
[FirstTestShare]
2. Комментарий
comment = Our First Test Share
3. Определим путь к расшариваемой папке в нашей файловой системе
Путь должен быть абсолютным
path = /opt/FirstTestShare
4. Явно указываем, что эта папка должна быть видима
Если поставить no, то она будет скрыта, но по прямому пути будет доступна.
browseable = yes
5. Разрешаем запись в нашу шару
writeable = yes
6. Определяем права, которые будут выдаваться файлам, залитым на шару
create mask = 0775
7. Определяем права, которые будут выдаваться директориям, созданным или залитым 
directory mask = 0775
8. Проверить конфигурационный файл на корректность
testparm -s 
9. После сохранения корректного конфигурационного файла перезапускаем сервис samba
sudo service smbd restart
10. добавляем сервис в автозагрузку
sudo systemctl enable smbd
11. Просмотреть статус процесса
sudo service smbd status
12. samba или smbd

Добавить доступ к шаре мы можем лишь тем пользователям, 
которые созданы локально на файловом сервере
можем задать этим пользователям любой пароль
sudo useradd -c "samba test n1" -s /sbin/nologin test1
sudo useradd -c "samba test n2" -s /sbin/nologin test2
sudo useradd -c "samba test n3" -s /sbin/nologin test3
Параметр -s /sbin/nologin означает, что эти пользователи не имеют права логиниться в консоль сервера. 
Это важно с точки зрения безопасности

sudo smbpasswd -a test 1
[sudo] пароль для elve New SMB password:
sudo smbpasswd -a test 2
sudo smbpasswd -a test 3
можем как создавать свои папки и файлы, так и читать папки и файлы других пользователей
Однако прав на удаление и редактирование файлов и папок других пользователей у нас нет
Изменить это поведение можно через параметры create mask и directory mask

Требуется групповая работа над файлами
create mask и directory mask настроены так, что файлы пользователя 
может редактировать либо он, либо кто-то из общей с ним группы. Для всех остальных только чтение.
По умолчанию при создании пользователя под него в системе создается одноименная группа.
Значит будем настраивать общую группу для пользователей test1 и test2
1. Создаем новую группу командой:
sudo groupadd buh
2. Устанавливаем группу buh по умолчанию для пользователей test1 и test2
sudo usermod -aG buh test1
sudo usermod -aG buh test2
3. перезапускаем samba, чтобы пользователи перелогинились на шару
sudo service smbd restart
4. Меняем настройки владельца для всех файлов, которые уже были созданы и для самой папки Buh
sudo chown -R test1:buh /opt/FirstTestShare/Buh

Утилита диагностики smbstatus
Вывод программы 
1. Список открытых сессий PID - идентификатор сессии
2. Список открытых шар, с указанием pid сессии
3. Список заблокированных на запись файлов
что PID сессии равнозначен Proccess ID в ОС Linux
Заблокированный файл в 3-м разделе будет иметь статус DENY_WRITE в поле DenyMode
- Смотрим PID, идем в первый раздел и видим IP-компьютера
- освободим файл принудительно
Находим PID залоченного файла и выполняем команду
- sudo kill -9 PID
Принудительно завершили процесс, занимающий файл

1. Настраивать файловый сервер Samba.
2. Настраивать групповую работу с файлами на шаре
3. Освобождать заблокированные на запись файлы на шаре.